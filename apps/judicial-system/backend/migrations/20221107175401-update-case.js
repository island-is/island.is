'use strict'

const replaceEnum = require('sequelize-replace-enum-postgres').default

module.exports = {
  up: async (queryInterface, Sequelize) => {
    // replaceEnum does not support transactions
    await replaceEnum({
      queryInterface,
      tableName: 'case',
      columnName: 'type',
      newValues: [
        // Indictment cases
        'INDICTMENT', // new type that eventually replaces all indictment types
        'AGGRAVATED_ASSAULT',
        'ALCOHOL_LAWS',
        'ASSAULT_LEADING_TO_DEATH',
        'ATTEMPTED_MURDER',
        'BREAKING_AND_ENTERING',
        'CHILD_PROTECTION_LAWS',
        'COVER_UP',
        'CUSTOMS_VIOLATION',
        'DOMESTIC_VIOLENCE',
        'EMBEZZLEMENT',
        'FRAUD',
        'INDECENT_EXPOSURE',
        'INTIMATE_RELATIONS',
        'LEGAL_ENFORCEMENT_LAWS',
        'LOOTING',
        'MAJOR_ASSAULT',
        'MINOR_ASSAULT',
        'MONEY_LAUNDERING',
        'MURDER',
        'NARCOTICS_OFFENSE',
        'NAVAL_LAW_VIOLATION',
        'OTHER_CRIMINAL_OFFENSES',
        'OTHER_OFFENSES',
        'POLICE_REGULATIONS',
        'PROPERTY_DAMAGE',
        'PUBLIC_SERVICE_VIOLATION',
        'RAPE',
        'SEXUAL_OFFENSES_OTHER_THAN_RAPE',
        'TAX_VIOLATION',
        'THEFT',
        'THREAT',
        'TRAFFIC_VIOLATION',
        'UTILITY_THEFT',
        'WEPONS_VIOLATION',
        // Restriction Cases
        'ADMISSION_TO_FACILITY',
        'CUSTODY',
        'TRAVEL_BAN',
        // Investigation Cases
        'AUTOPSY',
        'BANKING_SECRECY_WAIVER',
        'BODY_SEARCH',
        'ELECTRONIC_DATA_DISCOVERY_INVESTIGATION',
        'EXPULSION_FROM_HOME',
        'INTERNET_USAGE',
        'OTHER',
        'PHONE_TAPPING',
        'PSYCHIATRIC_EXAMINATION',
        'RESTRAINING_ORDER',
        'RESTRAINING_ORDER_AND_EXPULSION_FROM_HOME',
        'SEARCH_WARRANT',
        'SOUND_RECORDING_EQUIPMENT',
        'TELECOMMUNICATIONS',
        'TRACKING_EQUIPMENT',
        'VIDEO_RECORDING_EQUIPMENT',
      ],
      enumName: 'enum_case_type',
    })

    await queryInterface.sequelize.transaction(async (transaction) =>
      queryInterface
        .addColumn(
          'case',
          'indictment_sub_type',
          {
            type: Sequelize.ENUM(
              'AGGRAVATED_ASSAULT',
              'ALCOHOL_LAWS',
              'ASSAULT_LEADING_TO_DEATH',
              'ATTEMPTED_MURDER',
              'BREAKING_AND_ENTERING',
              'CHILD_PROTECTION_LAWS',
              'COVER_UP',
              'CUSTOMS_VIOLATION',
              'DOMESTIC_VIOLENCE',
              'EMBEZZLEMENT',
              'FRAUD',
              'INDECENT_EXPOSURE',
              'INTIMATE_RELATIONS',
              'LEGAL_ENFORCEMENT_LAWS',
              'LOOTING',
              'MAJOR_ASSAULT',
              'MINOR_ASSAULT',
              'MONEY_LAUNDERING',
              'MURDER',
              'NARCOTICS_OFFENSE',
              'NAVAL_LAW_VIOLATION',
              'OTHER_CRIMINAL_OFFENSES',
              'OTHER_OFFENSES',
              'POLICE_REGULATIONS',
              'PROPERTY_DAMAGE',
              'PUBLIC_SERVICE_VIOLATION',
              'RAPE',
              'SEXUAL_OFFENSES_OTHER_THAN_RAPE',
              'TAX_VIOLATION',
              'THEFT',
              'THREAT',
              'TRAFFIC_VIOLATION',
              'UTILITY_THEFT',
              'WEPONS_VIOLATION',
            ),
            allowNull: true,
          },
          { transaction },
        )
        .then(() =>
          queryInterface.sequelize.query(
            `UPDATE "case" SET
            indictment_sub_type = type::TEXT::enum_case_indictment_sub_type,
            type = 'INDICTMENT'
            WHERE type in (
            'AGGRAVATED_ASSAULT',
            'ALCOHOL_LAWS',
            'ASSAULT_LEADING_TO_DEATH',
            'ATTEMPTED_MURDER',
            'BREAKING_AND_ENTERING',
            'CHILD_PROTECTION_LAWS',
            'COVER_UP',
            'CUSTOMS_VIOLATION',
            'DOMESTIC_VIOLENCE',
            'EMBEZZLEMENT',
            'FRAUD',
            'INDECENT_EXPOSURE',
            'INTIMATE_RELATIONS',
            'LEGAL_ENFORCEMENT_LAWS',
            'LOOTING',
            'MAJOR_ASSAULT',
            'MINOR_ASSAULT',
            'MONEY_LAUNDERING',
            'MURDER',
            'NARCOTICS_OFFENSE',
            'NAVAL_LAW_VIOLATION',
            'OTHER_CRIMINAL_OFFENSES',
            'OTHER_OFFENSES',
            'POLICE_REGULATIONS',
            'PROPERTY_DAMAGE',
            'PUBLIC_SERVICE_VIOLATION',
            'RAPE',
            'SEXUAL_OFFENSES_OTHER_THAN_RAPE',
            'TAX_VIOLATION',
            'THEFT',
            'THREAT',
            'TRAFFIC_VIOLATION',
            'UTILITY_THEFT',
            'WEPONS_VIOLATION'
          )`,
            { transaction },
          ),
        ),
    )

    // replaceEnum does not support transactions
    return replaceEnum({
      queryInterface,
      tableName: 'case',
      columnName: 'type',
      newValues: [
        // Indictment cases
        'INDICTMENT',
        // Restriction Cases
        'ADMISSION_TO_FACILITY',
        'CUSTODY',
        'TRAVEL_BAN',
        // Investigation Cases
        'AUTOPSY',
        'BANKING_SECRECY_WAIVER',
        'BODY_SEARCH',
        'ELECTRONIC_DATA_DISCOVERY_INVESTIGATION',
        'EXPULSION_FROM_HOME',
        'INTERNET_USAGE',
        'OTHER',
        'PHONE_TAPPING',
        'PSYCHIATRIC_EXAMINATION',
        'RESTRAINING_ORDER',
        'RESTRAINING_ORDER_AND_EXPULSION_FROM_HOME',
        'SEARCH_WARRANT',
        'SOUND_RECORDING_EQUIPMENT',
        'TELECOMMUNICATIONS',
        'TRACKING_EQUIPMENT',
        'VIDEO_RECORDING_EQUIPMENT',
      ],
      enumName: 'enum_case_type',
    })
  },

  down: async (queryInterface) => {
    // replaceEnum does not support transactions
    await replaceEnum({
      queryInterface,
      tableName: 'case',
      columnName: 'type',
      newValues: [
        // Indictment cases
        'INDICTMENT', // old type that will eventually be removed
        'AGGRAVATED_ASSAULT',
        'ALCOHOL_LAWS',
        'ASSAULT_LEADING_TO_DEATH',
        'ATTEMPTED_MURDER',
        'BREAKING_AND_ENTERING',
        'CHILD_PROTECTION_LAWS',
        'COVER_UP',
        'CUSTOMS_VIOLATION',
        'DOMESTIC_VIOLENCE',
        'EMBEZZLEMENT',
        'FRAUD',
        'INDECENT_EXPOSURE',
        'INTIMATE_RELATIONS',
        'LEGAL_ENFORCEMENT_LAWS',
        'LOOTING',
        'MAJOR_ASSAULT',
        'MINOR_ASSAULT',
        'MONEY_LAUNDERING',
        'MURDER',
        'NARCOTICS_OFFENSE',
        'NAVAL_LAW_VIOLATION',
        'OTHER_CRIMINAL_OFFENSES',
        'OTHER_OFFENSES',
        'POLICE_REGULATIONS',
        'PROPERTY_DAMAGE',
        'PUBLIC_SERVICE_VIOLATION',
        'RAPE',
        'SEXUAL_OFFENSES_OTHER_THAN_RAPE',
        'TAX_VIOLATION',
        'THEFT',
        'THREAT',
        'TRAFFIC_VIOLATION',
        'UTILITY_THEFT',
        'WEPONS_VIOLATION',
        // Restriction Cases
        'ADMISSION_TO_FACILITY',
        'CUSTODY',
        'TRAVEL_BAN',
        // Investigation Cases
        'AUTOPSY',
        'BANKING_SECRECY_WAIVER',
        'BODY_SEARCH',
        'ELECTRONIC_DATA_DISCOVERY_INVESTIGATION',
        'EXPULSION_FROM_HOME',
        'INTERNET_USAGE',
        'OTHER',
        'PHONE_TAPPING',
        'PSYCHIATRIC_EXAMINATION',
        'RESTRAINING_ORDER',
        'RESTRAINING_ORDER_AND_EXPULSION_FROM_HOME',
        'SEARCH_WARRANT',
        'SOUND_RECORDING_EQUIPMENT',
        'TELECOMMUNICATIONS',
        'TRACKING_EQUIPMENT',
        'VIDEO_RECORDING_EQUIPMENT',
      ],
      enumName: 'enum_case_type',
    })

    await queryInterface.sequelize.transaction(async (transaction) =>
      queryInterface.sequelize
        .query(
          `UPDATE "case" SET type = indictment_sub_type::TEXT::enum_case_type WHERE type = 'INDICTMENT'`,
          { transaction },
        )
        .then(() =>
          queryInterface.removeColumn('case', 'indictment_sub_type', {
            transaction,
          }),
        )
        .then(() =>
          queryInterface.sequelize.query(
            'DROP TYPE IF EXISTS enum_case_indictment_sub_type',
            { transaction },
          ),
        ),
    )

    // replaceEnum does not support transactions
    return replaceEnum({
      queryInterface,
      tableName: 'case',
      columnName: 'type',
      newValues: [
        // Indictment cases
        'AGGRAVATED_ASSAULT',
        'ALCOHOL_LAWS',
        'ASSAULT_LEADING_TO_DEATH',
        'ATTEMPTED_MURDER',
        'BREAKING_AND_ENTERING',
        'CHILD_PROTECTION_LAWS',
        'COVER_UP',
        'CUSTOMS_VIOLATION',
        'DOMESTIC_VIOLENCE',
        'EMBEZZLEMENT',
        'FRAUD',
        'INDECENT_EXPOSURE',
        'INTIMATE_RELATIONS',
        'LEGAL_ENFORCEMENT_LAWS',
        'LOOTING',
        'MAJOR_ASSAULT',
        'MINOR_ASSAULT',
        'MONEY_LAUNDERING',
        'MURDER',
        'NARCOTICS_OFFENSE',
        'NAVAL_LAW_VIOLATION',
        'OTHER_CRIMINAL_OFFENSES',
        'OTHER_OFFENSES',
        'POLICE_REGULATIONS',
        'PROPERTY_DAMAGE',
        'PUBLIC_SERVICE_VIOLATION',
        'RAPE',
        'SEXUAL_OFFENSES_OTHER_THAN_RAPE',
        'TAX_VIOLATION',
        'THEFT',
        'THREAT',
        'TRAFFIC_VIOLATION',
        'UTILITY_THEFT',
        'WEPONS_VIOLATION',
        // Restriction Cases
        'ADMISSION_TO_FACILITY',
        'CUSTODY',
        'TRAVEL_BAN',
        // Investigation Cases
        'AUTOPSY',
        'BANKING_SECRECY_WAIVER',
        'BODY_SEARCH',
        'ELECTRONIC_DATA_DISCOVERY_INVESTIGATION',
        'EXPULSION_FROM_HOME',
        'INTERNET_USAGE',
        'OTHER',
        'PHONE_TAPPING',
        'PSYCHIATRIC_EXAMINATION',
        'RESTRAINING_ORDER',
        'RESTRAINING_ORDER_AND_EXPULSION_FROM_HOME',
        'SEARCH_WARRANT',
        'SOUND_RECORDING_EQUIPMENT',
        'TELECOMMUNICATIONS',
        'TRACKING_EQUIPMENT',
        'VIDEO_RECORDING_EQUIPMENT',
      ],
      enumName: 'enum_case_type',
    })
  },
}
